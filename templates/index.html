<!DOCTYPE html>
<html lang="en" data-bs-theme="dark" data-theme-color="default">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Garena Account Checker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        :root {
            --bs-primary: #0d6efd;
            --bs-primary-rgb: 13, 110, 253;
            --body-bg: #121212;
            --card-bg: #1e1e1e;
            --logs-bg: #0c0c0c;
            --highlight-color: #dc3545;
        }
        html[data-theme-color="danger"] { --bs-primary: #dc3545; --bs-primary-rgb: 220, 53, 69; }
        html[data-theme-color="success"] { --bs-primary: #28a745; --bs-primary-rgb: 40, 167, 69; }
        html[data-theme-color="warning"] { --bs-primary: #ffc107; --bs-primary-rgb: 255, 193, 7; }
        body { background-color: var(--body-bg); color: #e0e0e0; }
        .container { max-width: 1200px; }
        .banner { font-family: 'Courier New', Courier, monospace; white-space: pre; color: #888; text-align: center; font-size: 0.9em; line-height: 1.1; padding: 1rem 0; overflow-x: auto; }
        .banner .highlight {  color: var(--highlight-color); }
        .card { background-color: var(--card-bg); border: 1px solid #333; }
        .form-control, .form-select { background-color: #2a2a2a; color: #e0e0e0; border-color: #444; }
        .form-control:focus, .form-select:focus { background-color: #333; color: #fff; border-color: var(--bs-primary); box-shadow: 0 0 0 0.25rem rgba(var(--bs-primary-rgb), 0.25); }
        input[type="color"] { -webkit-appearance: none; -moz-appearance: none; appearance: none; width: 100%; height: 38px; padding: 0; border: 1px solid #444; border-radius: 0.375rem; background-color: transparent; cursor: pointer; }
        input[type="color"]::-webkit-color-swatch { border-radius: 0.375rem; border: none; }
        input[type="color"]::-moz-color-swatch { border-radius: 0.375rem; border: none; }
        .progress-bar, .btn-primary { background-color: var(--bs-primary); border-color: var(--bs-primary); }
        html[data-theme-color="warning"] .btn-primary { color: #000; }
        html[data-theme-color="warning"] .btn-primary:hover { color: #000; }
        #logs-container { height: 400px; background-color: var(--logs-bg); border: 1px solid #333; padding: 10px; overflow-y: scroll; font-family: 'Courier New', Courier, monospace; font-size: 0.85em; white-space: pre-wrap; word-wrap: break-word; }
        .log-line { display: flex; }
        .log-line .timestamp { color: #888; margin-right: 10px; flex-shrink: 0; }
        .progress-bar { transition: width 0.5s ease-in-out; }
        .text-success { color: #28a745 !important; } .text-danger { color: #dc3545 !important; } .text-warning { color: #ffc107 !important; } .text-info { color: #17a2b8 !important; }
        #captcha-modal { background-color: rgba(0,0,0,0.7); }
        .modal-footer { flex-wrap: wrap; }
        .captcha-action-btn { margin: 5px; }
    </style>
</head>
<body>
    <!-- USER STATUS BAR -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark bg-opacity-50 mb-2 border-bottom border-secondary">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1"><i class="bi bi-person-circle"></i> {{ user.username }}</span>
            <div class="d-flex align-items-center">
                {% if is_premium %}
                    <span class="badge bg-success me-3 fs-6"><i class="bi bi-star-fill"></i> Premium Tier</span>
                {% else %}
                    <span class="badge bg-secondary me-3 fs-6">Free Tier ({{ FREE_TIER_LIMIT }} lines)</span>
                    <a href="{{ url_for('redeem') }}" class="btn btn-sm btn-warning me-3"><i class="bi bi-key-fill"></i> Redeem Key</a>
                {% endif %}
                {% if user.is_admin %}
                    <a href="{{ url_for('admin_panel') }}" class="btn btn-sm btn-info me-3"><i class="bi bi-shield-shaded"></i> Admin Panel</a>
                {% endif %}
                <a href="{{ url_for('logout') }}" class="btn btn-sm btn-danger"><i class="bi bi-box-arrow-right"></i> Logout</a>
            </div>
        </div>
    </nav>
    <!-- END USER STATUS BAR -->

    <div class="container mt-4">
        <!-- THE REST OF THE ORIGINAL INDEX.HTML CONTENT -->
        <div class="banner">
                          :::!~!!!!!:.
                  .xUHWH!! !!?M88WHX:.
                .X*#M@$!!  !X!M$$$$$WWx:
               :!!!!!!?H! :!$!$$$$$$$$$8X:
             !!~  ~:~!! :~!$!%$$$$$$$$$$8X:
             :!~::!H![   ~.U$X!?W$$$$$$$MM!
             ~!~!!!!~~ .:XW$$$U!!?$$$$$$WMM!
               !:~~~ .:!M*T#$$$$WX??#MRRMMM!
               ~?WuxiW*     *#$$$$8!!!!??!!!
             :X- M$$$$  <span class="highlight">ñ£ò</span>   '#T#$T~!8$WUXU~
          :%'  ~%$$$Mm:         ~!~ ?$$$$$$
          :! .-   ~T$$$$8xx.  .xWW- ~‚Äù‚Äù##*''
  .....   -~~:&lt;  !    ~?T$@@W@*?$$ <span class="highlight">ñ£ò</span> /‚Äô
 W$@@M!!! .!~~ !!     .:XUW$W!~ '*~:   :
 %^~~'.:x%'!!  !H:   !WM$$$$Ti.: .!WUnn!
 :::~:!. :X~ .: ?H.!u *$$$$$$$!W:U!T$$M~
 .~~   :X@!.-~   ?@WTWo('*$$$W$TH$!
 Wi.~!X$?!-~    : ?$$$B$Wu(***$RM!
 $R@i.#~ !     :   -$$$$$%$Mm$;
 ?MXT@Wx.~    :     ~##$$$$M~
<span class="highlight" id="credits-span">           ÓÇ≤ÔÉß ùêèùê´ùêûùê¨ùêûùêßùê≠ùêûùêù ùêÅùê≤: PAPA MO ÔÉßÓòÇ</span>
        </div>
        <div class="row">
            <div class="col-lg-4">
                <div class="card mb-3">
                    <div class="card-header"><h5><i class="bi bi-gear-fill"></i> Control Panel</h5></div>
                    <div class="card-body">
                        <form id="start-form" action="{{ url_for('start_check') }}" method="POST" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="account_file" class="form-label">Account File (.txt)</label>
                                <input class="form-control" type="file" id="account_file" name="account_file" required>
                                {% if not is_premium %}<div class="form-text text-warning">Free tier is limited to the first {{ FREE_TIER_LIMIT }} accounts in the file.</div>{% endif %}
                            </div>
                            <div class="mb-3">
                                <label for="cookie_module" class="form-label">Cookie Module</label>
                                <select class="form-select" id="cookie_module" name="cookie_module">
                                    <option value="ken_cookie" selected>Ken Cookie</option>
                                    <option value="change_cookie">Change Cookie (Enhanced)</option>
                                    <option value="set_cookie">Numbered Set (from config)</option>
                                </select>
                            </div>
                            <div class="mb-3" id="cookie-number-input-wrapper" style="display: none;">
                                <label for="cookie_number_input" class="form-label">Use Fixed Cookie Number</label>
                                <input type="number" class="form-control" id="cookie_number_input" name="cookie_number" min="1" placeholder="e.g., 200 (optional)">
                                <div class="form-text">Leave empty to cycle through all cookies in the set.</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Telegram Notifications</label>
                                <div class="input-group mb-2"><span class="input-group-text"><i class="bi bi-robot"></i></span><input type="text" class="form-control" name="telegram_bot_token" placeholder="Bot Token" value="{{ bot_token }}"></div>
                                <div class="input-group mb-2"><span class="input-group-text"><i class="bi bi-person"></i></span><input type="text" class="form-control" name="telegram_chat_id" placeholder="Chat ID" value="{{ chat_id }}"></div>
                                <div class="input-group"><span class="input-group-text"><i class="bi bi-filter-circle"></i></span>
                                    <select class="form-select" id="telegram_level_filter" name="telegram_level_filter">
                                        <option value="all" selected>Send All Levels to Telegram</option>
                                        <option value="100+">Send Level 100+ to Telegram</option>
                                        <option value="none">Disable Telegram Notifications</option>
                                    </select>
                                </div>
                                <div class="form-check mt-2"><input class="form-check-input" type="checkbox" name="save_telegram_creds" id="save_telegram_creds" checked><label class="form-check-label" for="save_telegram_creds">Save credentials for this session</label></div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" id="use_cookie_set" name="use_cookie_set"><label class="form-check-label" for="use_cookie_set">Use hardcoded cookies from `cookie_config.py`</label></div>
                                <div class="form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" id="auto_delete" name="auto_delete"><label class="form-check-label" for="auto_delete">Delete account file on completion</label></div>
                                <div class="form-check form-switch"><input class="form-check-input" type="checkbox" role="switch" id="force_restart" name="force_restart"><label class="form-check-label" for="force_restart">Start from beginning (ignore saved progress)</label></div>
                            </div>
                            <div class="d-grid gap-2"><button type="submit" id="start-btn" class="btn btn-primary"><i class="bi bi-play-circle-fill"></i> Start Checker</button><button type="button" id="stop-btn" class="btn btn-danger" style="display: none;"><i class="bi bi-stop-circle-fill"></i> Stop Checker</button></div>
                        </form>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><h5 class="mb-0"><button class="btn btn-link-light text-decoration-none p-0 w-100 text-start" type="button" data-bs-toggle="collapse" data-bs-target="#appearance-settings"><i class="bi bi-palette-fill"></i> Appearance & Credits</button></h5></div>
                    <div id="appearance-settings" class="collapse"><div class="card-body">
                        <div class="mb-3"><label for="theme-selector" class="form-label">Main Theme Color</label><div id="theme-selector" class="d-flex gap-2"><button type="button" class="btn btn-sm w-100" style="background-color: #0d6efd;" data-theme="default" title="Default Blue"></button><button type="button" class="btn btn-sm w-100" style="background-color: #dc3545;" data-theme="danger" title="Red"></button><button type="button" class="btn btn-sm w-100" style="background-color: #28a745;" data-theme="success" title="Green"></button><button type="button" class="btn btn-sm w-100" style="background-color: #ffc107;" data-theme="warning" title="Yellow"></button></div></div>
                        <div class="row g-2 mb-3"><div class="col-6"><label for="highlight-color-picker" class="form-label small">Skull & Highlight</label><input type="color" id="highlight-color-picker" class="form-control" value="#dc3545"></div><div class="col-6"><label for="body-bg-picker" class="form-label small">Page BG</label><input type="color" id="body-bg-picker" class="form-control" value="#121212"></div><div class="col-6"><label for="card-bg-picker" class="form-label small">Card BG</label><input type="color" id="card-bg-picker" class="form-control" value="#1e1e1e"></div><div class="col-6"><label for="logs-bg-picker" class="form-label small">Logs BG</label><input type="color" id="logs-bg-picker" class="form-control" value="#0c0c0c"></div></div>
                        <div class="mb-3"><label for="credits-text-input" class="form-label">Credits Text</label><input type="text" class="form-control" id="credits-text-input" value="PAPA MO"></div>
                        <button type="button" id="reset-appearance-btn" class="btn btn-sm btn-outline-secondary w-100">Reset Appearance</button>
                    </div></div>
                </div>
            </div>
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header"><h5><i class="bi bi-terminal-fill"></i> Live Status</h5></div>
                    <div class="card-body">
                        <div class="progress mb-3" role="progressbar" style="height: 25px;"><div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" style="width: 0%">0%</div></div>
                        <div class="d-flex justify-content-between mb-2 text-muted"><small id="progress-text">Checked: 0 / 0</small><small id="current-account-text">Status: Idle</small></div>
                        <div id="stats-container" class="d-flex flex-wrap justify-content-around small p-2 rounded bg-dark mb-3">
                            <span><i class="bi bi-check-circle-fill text-success"></i> Hits: <span id="stats-hits">0</span></span><span><i class="bi bi-x-circle-fill text-danger"></i> Fails: <span id="stats-fails">0</span></span><span><i class="bi bi-key-fill text-warning"></i> Wrong Pass: <span id="stats-wrongpass">0</span></span><span><i class="bi bi-shield-fill-check text-success"></i> Clean: <span id="stats-clean">0</span></span><span><i class="bi bi-shield-fill-exclamation text-warning"></i> Not Clean: <span id="stats-notclean">0</span></span><span><i class="bi bi-send-fill text-info"></i> TG Sent: <span id="stats-tgsent">0</span></span><span><i class="bi bi-robot text-danger"></i> CAPTCHA: <span id="stats-captcha">0</span></span>
                        </div>
                        <div id="logs-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="captcha-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered"><div class="modal-content">
            <div class="modal-header bg-danger text-white"><h5 class="modal-title"><i class="bi bi-shield-lock-fill"></i> CAPTCHA Detected</h5></div>
            <div class="modal-body"><p>The checker is paused. A cookie was likely blocked and has been put on a cooldown.</p><p>Please choose an action:</p></div>
            <div class="modal-footer d-flex justify-content-center">
                <button type="button" class="btn btn-secondary captcha-action-btn" data-action="next_cookie"><i class="bi bi-arrow-right-circle"></i> Try Next Cookie</button>
                <button type="button" class="btn btn-primary captcha-action-btn" data-action="fetch_pool"><i class="bi bi-cloud-download-fill"></i> Fetch New Cookies</button>
                <button type="button" class="btn btn-warning captcha-action-btn" data-action="retry_ip"><i class="bi bi-globe"></i> I Changed My IP/VPN</button>
                <button type="button" class="btn btn-danger captcha-action-btn" data-action="stop_checker"><i class="bi bi-stop-circle-fill"></i> Stop & Exit</button>
            </div>
        </div></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const startForm = document.getElementById('start-form'), startBtn = document.getElementById('start-btn'), stopBtn = document.getElementById('stop-btn'), logsContainer = document.getElementById('logs-container'), progressBar = document.getElementById('progress-bar'), progressText = document.getElementById('progress-text'), currentAccountText = document.getElementById('current-account-text'), statsHits = document.getElementById('stats-hits'), statsFails = document.getElementById('stats-fails'), statsWrongPass = document.getElementById('stats-wrongpass'), statsClean = document.getElementById('stats-clean'), statsNotClean = document.getElementById('stats-notclean'), statsTgSent = document.getElementById('stats-tgsent'), statsCaptcha = document.getElementById('stats-captcha'), captchaModal = new bootstrap.Modal(document.getElementById('captcha-modal'));
            const htmlElement = document.documentElement, themeButtons = document.querySelectorAll('#theme-selector button'), highlightColorPicker = document.getElementById('highlight-color-picker'), bodyBgPicker = document.getElementById('body-bg-picker'), cardBgPicker = document.getElementById('card-bg-picker'), logsBgPicker = document.getElementById('logs-bg-picker'), creditsTextInput = document.getElementById('credits-text-input'), creditsSpan = document.getElementById('credits-span'), resetAppearanceBtn = document.getElementById('reset-appearance-btn');
            const cookieModuleSelect = document.getElementById('cookie_module'), cookieNumberWrapper = document.getElementById('cookie-number-input-wrapper');
            let statusInterval, lastLogCount = 0;
            const APPEARANCE_STORAGE_KEY = 'garenaCheckerAppearance';
            function applyAndSaveAppearance() {
                const settings = { mainTheme: htmlElement.getAttribute('data-theme-color') || 'default', highlightColor: highlightColorPicker.value, bodyBg: bodyBgPicker.value, cardBg: cardBgPicker.value, logsBg: logsBgPicker.value, creditsText: creditsTextInput.value };
                htmlElement.style.setProperty('--highlight-color', settings.highlightColor); htmlElement.style.setProperty('--body-bg', settings.bodyBg); htmlElement.style.setProperty('--card-bg', settings.cardBg); htmlElement.style.setProperty('--logs-bg', settings.logsBg);
                creditsSpan.textContent = `           ÓÇ≤ÔÉß ùêèùê´ùêûùê¨ùêûùêßùê≠ùêûùêù ùêÅùê≤: ${settings.creditsText} ÔÉßÓòÇ`;
                localStorage.setItem(APPEARANCE_STORAGE_KEY, JSON.stringify(settings));
            }
            function loadAppearance() {
                const savedSettings = localStorage.getItem(APPEARANCE_STORAGE_KEY);
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    htmlElement.setAttribute('data-theme-color', settings.mainTheme);
                    highlightColorPicker.value = settings.highlightColor; bodyBgPicker.value = settings.bodyBg; cardBgPicker.value = settings.cardBg; logsBgPicker.value = settings.logsBg; creditsTextInput.value = settings.creditsText;
                }
                applyAndSaveAppearance();
            }
            themeButtons.forEach(button => { button.addEventListener('click', () => { htmlElement.setAttribute('data-theme-color', button.dataset.theme); applyAndSaveAppearance(); }); });
            [highlightColorPicker, bodyBgPicker, cardBgPicker, logsBgPicker, creditsTextInput].forEach(el => { el.addEventListener('input', applyAndSaveAppearance); });
            resetAppearanceBtn.addEventListener('click', () => { localStorage.removeItem(APPEARANCE_STORAGE_KEY); location.reload(); });
            loadAppearance();
            function toggleCookieNumberInput() { cookieNumberWrapper.style.display = cookieModuleSelect.value === 'set_cookie' ? 'block' : 'none'; }
            cookieModuleSelect.addEventListener('change', toggleCookieNumberInput);
            toggleCookieNumberInput();
            function updateUI(status) {
                if (status.running) { startBtn.style.display = 'none'; stopBtn.style.display = 'block'; } else { startBtn.style.display = 'block'; stopBtn.style.display = 'none'; if (statusInterval) { clearInterval(statusInterval); } }
                const progress = status.total > 0 ? (status.progress / status.total) * 100 : 0;
                progressBar.style.width = progress.toFixed(2) + '%'; progressBar.textContent = progress.toFixed(0) + '%';
                progressText.textContent = `Checked: ${status.progress} / ${status.total}`; currentAccountText.textContent = `Current: ${status.current_account || 'N/A'}`;
                if (status.stats) { statsHits.textContent = status.stats.successful || 0; statsFails.textContent = status.stats.failed || 0; statsWrongPass.textContent = status.stats.incorrect_pass || 0; statsClean.textContent = status.stats.clean || 0; statsNotClean.textContent = status.stats.not_clean || 0; statsTgSent.textContent = status.stats.telegram_sent || 0; statsCaptcha.textContent = status.stats.captcha_count || 0; }
                if (status.logs.length > lastLogCount) {
                    status.logs.slice(lastLogCount).forEach(log => {
                        const logElement = document.createElement('div'); logElement.className = `log-line ${log.class}`; logElement.innerHTML = `<span class="timestamp">${log.timestamp}</span><span>${log.message}</span>`; logsContainer.appendChild(logElement);
                    });
                    logsContainer.scrollTop = logsContainer.scrollHeight; lastLogCount = status.logs.length;
                }
                if (status.captcha_detected) { captchaModal.show(); } else { captchaModal.hide(); }
                if(status.final_summary && !status.running) {
                    const summaryElement = document.createElement('pre'); summaryElement.className = 'text-success p-2 mt-2 border border-success rounded'; summaryElement.textContent = status.final_summary; logsContainer.appendChild(summaryElement); logsContainer.scrollTop = logsContainer.scrollHeight;
                }
            }
            function fetchStatus() { fetch('/status').then(r => r.json()).then(updateUI).catch(e => { console.error('Error fetching status:', e); if(statusInterval) clearInterval(statusInterval); }); }
            startForm.addEventListener('submit', function (e) {
                startBtn.disabled = true; startBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Starting...';
                setTimeout(() => { lastLogCount = 0; logsContainer.innerHTML = ''; statusInterval = setInterval(fetchStatus, 1500); }, 500);
            });
            stopBtn.addEventListener('click', function () {
                fetch('/stop_check', { method: 'POST' }).then(r => r.json()).then(data => { stopBtn.disabled = true; stopBtn.textContent = "Stopping..."; });
            });
            document.querySelectorAll('.captcha-action-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const formData = new FormData(); formData.append('action', this.dataset.action);
                    fetch('/captcha_action', { method: 'POST', body: formData }); captchaModal.hide();
                });
            });
            fetchStatus(); statusInterval = setInterval(fetchStatus, 1500);
        });
    </script>
</body>
</html>